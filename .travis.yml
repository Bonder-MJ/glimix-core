language: python
cache:
  directories:
  - "$HOME/download"
matrix:
  include:
  - os: linux
    sudo: false
    dist: trusty
    python: '2.7'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.4'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.5'
  - os: osx
    language: generic
    env: TRAVIS_PYTHON_VERSION=3.5
before_install:
- wget https://raw.githubusercontent.com/Horta/travis-miniconda/master/install.sh
  -O install.sh
- chmod +x install.sh
- travis_retry bash -x ./install.sh
install:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
before_script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- pwd
- find .
- python setup.py test
script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py sdist
- pip install dist/`ls dist | grep -i -E '\.(gz)$' | head -1`
- pushd /
- python -c "import limix_inference; limix_inference.test()"
- popd
notifications:
  email: false
branches:
  only:
  - master
deploy:
  provider: pypi
  user: dhorta
  password:
    secure: h7YjlGpmltbpuWUrdNpxcut/Er7ZcBOWoHaE45QSNgR1ZGJFgdduYBc1u6TnvLQsVC4iUUbksMEfyR+1R7Fywda48B16aSC09BTgi/MT8vfNfojlolxBdVeVibIVS7p1/9HdfYt7cnMWRWM3SyhGmO0Wu8d2q85aek6Fy0dqZ47NpfgInNvYEFZYKiM+O+S4fHgcjOOiKRXrJPHN9E1gCWBw2gD6yBsnX+yFliF7AdmNHrYlriVnu/YbsFokWIkPUbinaP4H1n/sqAtsFy12VCU6GegBlFjK/QFRJPwEYNDf1jYJuPk0Tolj9Df6beA+4lnZBWxfqP66zn+tHCWwqamNLZdQKLXUaTsEdkmnVmxrJSIOgScFGm+/fNlURLdZXcmSeQKBRYydB1xKFYfIgq1xngC1uExaOCAf4VDJTgUnZ7LZcA3xOb9WeXtzlNMV+vhJN60pqFlCsVWXWj0r6RIa/05etqqiDSNQgpy9dVQveJ+K8viTRMJeomm/KbZpkB+N/swXmkbMR7D/1Tupc/jjrOgpena56xYTzZc3yvp/m6F1rmWF90cJk9OucA3YixFlQ2fnppLtSgkEVKCjLxwinvJCISB40qIICvtgM5ZZlyxcPWg2PIxOSHlJnwVGZvHMCgg3neWx2SzNDiEmYEU6imuGZr3Dc0fAShGzAJU=
  on:
    distributions: sdist bdist_wheel
    repo: Horta/limix-inference
